name: Internal - Checks for dist

on:
  workflow_call:

permissions: {}

jobs:
  check-dist:
    name: Check dist
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
        with:
          persist-credentials: false

      - id: setup-node
        uses: hoverkraft-tech/ci-github-nodejs/actions/setup-node@a9809af04394e66675b8644865be1ddcec02cdcd # 0.20.0

      - name: Build dist/ Directory
        id: package
        run: ${{ steps.setup-node.outputs.run-script-command }} package

      # This will fail the workflow if the PR wasn't created by Dependabot.
      - name: Compare Directories
        id: diff
        run: |
          if [ "$(git diff --ignore-space-at-eol --text dist/ | wc -l)" -gt "0" ]; then
            echo "Detected uncommitted changes after package. See status below:"
            git diff --ignore-space-at-eol --text dist/
            exit 1
          fi
